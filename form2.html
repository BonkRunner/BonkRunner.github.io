<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>BonkRunner with Power-ups</title>
<style>
  body { font-family: sans-serif; margin: 0; background: #111; color: #eee; text-align: center; }
  .hidden { display: none; }
  .screen { padding: 20px; }
  input { padding: 8px; margin: 6px; border-radius: 4px; border: none; }
  button { padding: 10px 16px; margin: 8px; border: none; border-radius: 4px; background: #28a; color: #fff; cursor: pointer; }
  canvas { background: #222; display: block; margin: 20px auto; border-radius: 8px; }
</style>
</head>
<body>

<div id="paymentScreen" class="screen">
  <h1>BonkRunner</h1>
  <p>Pay $1.99 to play</p>
  <button id="payBtn">Pay Now</button>
  <p id="payStatus"></p>
</div>

<div id="formScreen" class="screen hidden">
  <h2>Player Info</h2>
  <form id="playerForm">
    <input id="name" type="text" placeholder="Your name" required><br>
    <input id="email" type="email" placeholder="you@example.com" required><br>
    <button type="submit">Start Game</button>
  </form>
</div>

<div id="gameScreen" class="screen hidden">
  <h2>BonkRunner Game</h2>
  <canvas id="gameCanvas" width="800" height="300"></canvas>
  <p id="score">Score: 0 | Lives: 3 | Power-up: None</p>
</div>

<script>
const payBtn = document.getElementById('payBtn');
const payStatus = document.getElementById('payStatus');
const paymentScreen = document.getElementById('paymentScreen');
const formScreen = document.getElementById('formScreen');
const gameScreen = document.getElementById('gameScreen');

let playerName, playerEmail;

// ---- Fake payment ----
payBtn.addEventListener('click', () => {
  payStatus.textContent = "Processing payment...";
  setTimeout(() => {
    payStatus.textContent = "Payment successful âœ…";
    setTimeout(() => {
      paymentScreen.classList.add('hidden');
      formScreen.classList.remove('hidden');
    }, 1000);
  }, 1500);
});

// ---- Form ----
document.getElementById('playerForm').addEventListener('submit', (e) => {
  e.preventDefault();
  playerName = document.getElementById('name').value.trim();
  playerEmail = document.getElementById('email').value.trim();
  if (playerName && playerEmail) {
    formScreen.classList.add('hidden');
    gameScreen.classList.remove('hidden');
    startGame();
  }
});

function startGame() {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const groundY = 250;

  let lives = 3;
  let player = { x: 50, y: groundY - 30, w: 30, h: 30, vy: 0, powerUp: null, powerTimer: 0 };
  let gravity = 0.7;
  let jumpForce = -12;
  let obstacles = [];
  let spawnTimer = 0;
  let score = 0;
  let speed = 5;
  let gameOver = false;
  let powerUps = [];

  const powerTypes = ['shield', 'speed'];

  document.addEventListener('keydown', (e) => {
    if (e.code === 'Space' && player.y >= groundY - player.h) {
      player.vy = jumpForce;
    }
  });

  function spawnObstacle() {
    const height = 30 + Math.random()*20;
    obstacles.push({ x: canvas.width, y: groundY - height, w: 20, h: height });
  }

  function spawnPowerUp() {
    const type = powerTypes[Math.floor(Math.random()*powerTypes.length)];
    powerUps.push({ x: canvas.width, y: groundY - 50, w: 20, h: 20, type });
  }

  function resetLife() {
    player.y = groundY - 30;
    player.vy = 0;
    player.powerUp = null;
    player.powerTimer = 0;
    obstacles = [];
    powerUps = [];
    spawnTimer = 0;
    score = 0;
    speed = 5;
    gameOver = false;
    updateScore();
    requestAnimationFrame(loop);
  }

  function updateScore() {
    document.getElementById('score').textContent = `Score: ${score} | Lives: ${lives} | Power-up: ${player.powerUp || 'None'}`;
  }

  function loop() {
    if (gameOver) return;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ---- Update player ----
    player.vy += gravity;
    player.y += player.vy;
    if (player.y > groundY - player.h) { player.y = groundY - player.h; player.vy = 0; }

    // Draw player
    ctx.fillStyle = player.powerUp === 'shield' ? '#0ff' : '#0f0';
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // ---- Spawn obstacles & power-ups ----
    spawnTimer += 1;
    if (spawnTimer > 90 - speed*2) { 
      spawnObstacle();
      if (Math.random() < 0.3) spawnPowerUp(); // 30% chance
      spawnTimer = 0;
    }

    // ---- Update obstacles ----
    ctx.fillStyle = "#f00";
    for (let i = obstacles.length-1; i>=0; i--) {
      const o = obstacles[i];
      o.x -= speed;
      ctx.fillRect(o.x, o.y, o.w, o.h);

      // Collision
      if (player.x < o.x + o.w && player.x + player.w > o.x &&
          player.y < o.y + o.h && player.y + player.h > o.y) {
        if (player.powerUp !== 'shield') {
          lives--;
          if (lives > 0) {
            resetLife();
          } else {
            alert("Game Over! All lives lost. Returning to form.");
            gameScreen.classList.add('hidden');
            formScreen.classList.remove('hidden');
          }
          return;
        }
      }

      if (o.x + o.w < 0) obstacles.splice(i, 1);
    }

    // ---- Update power-ups ----
    ctx.fillStyle = "#ff0";
    for (let i = powerUps.length-1; i>=0; i--) {
      const p = powerUps[i];
      p.x -= speed;
      ctx.fillRect(p.x, p.y, p.w, p.h);

      // Collect power-up
      if (player.x < p.x + p.w && player.x + player.w > p.x &&
          player.y < p.y + p.h && player.y + player.h > p.y) {
        player.powerUp = p.type;
        player.powerTimer = 300; // lasts 5 seconds approx
        if (p.type === 'speed') speed += 3;
        powerUps.splice(i,1);
      }

      if (p.x + p.w < 0) powerUps.splice(i,1);
    }

    // ---- Power-up timer ----
    if (player.powerUp) {
      player.powerTimer--;
      if (player.powerTimer <= 0) {
        if (player.powerUp === 'speed') speed -= 3;
        player.powerUp = null;
      }
    }

    // ---- Score ----
    score++;
    speed += 0.001; // Gradually increase speed
    updateScore();

    if (!gameOver) requestAnimationFrame(loop);
  }

  loop();
}
</script>
</body>
</html>
